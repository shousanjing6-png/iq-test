<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IQãƒ†ã‚¹ãƒˆ</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        .registration-container {
            background: white;
            border-radius: 15px;
            padding: 40px;
            max-width: 500px;
            margin: 50px auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .registration-container h2 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            box-sizing: border-box;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .date-inputs {
            display: flex;
            gap: 10px;
        }

        .date-inputs select {
            flex: 1;
        }

        .register-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            cursor: pointer;
            margin-top: 20px;
        }

        .register-btn:hover {
            opacity: 0.9;
        }

        .form-error {
            color: #e74c3c;
            font-size: 0.9rem;
            margin-top: 5px;
            display: none;
        }

        .test-flow {
            display: none;
        }

        .flow-container {
            background: white;
            border-radius: 15px;
            padding: 40px;
            max-width: 700px;
            margin: 50px auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .flow-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .flow-header h2 {
            color: #333;
        }

        .examinee-info {
            background: #f8f9ff;
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
        }

        .flow-steps {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .flow-step {
            display: flex;
            align-items: center;
            padding: 20px;
            border: 2px solid #ddd;
            border-radius: 10px;
            transition: all 0.3s;
        }

        .flow-step.active {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .flow-step.completed {
            border-color: #2ecc71;
            background: #e8f8f0;
        }

        .flow-step.locked {
            opacity: 0.5;
        }

        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 20px;
        }

        .flow-step.active .step-number {
            background: #667eea;
            color: white;
        }

        .flow-step.completed .step-number {
            background: #2ecc71;
            color: white;
        }

        .step-content {
            flex: 1;
        }

        .step-content h3 {
            margin: 0 0 5px 0;
            color: #333;
        }

        .step-content p {
            margin: 0;
            color: #666;
            font-size: 0.9rem;
        }

        .step-btn {
            padding: 10px 25px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
        }

        .step-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .step-status {
            color: #2ecc71;
            font-weight: bold;
        }

        .complete-container {
            display: none;
            text-align: center;
        }

        .complete-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>IQãƒ†ã‚¹ãƒˆ</h1>
            <p class="subtitle">ã‚ãªãŸã®çŸ¥èƒ½ã‚’å¤šè§’çš„ã«æ¸¬å®šã—ã¾ã™</p>
        </header>

        <!-- å—é¨“è€…ç™»éŒ²ç”»é¢ -->
        <div id="registrationScreen">
            <div class="registration-container">
                <h2>å—é¨“è€…æƒ…å ±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</h2>

                <div class="form-group">
                    <label>æ°å <span style="color:#e74c3c;">*</span></label>
                    <input type="text" id="examineeName" placeholder="å±±ç”° å¤ªéƒ">
                    <p class="form-error" id="nameError">æ°åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</p>
                </div>

                <div class="form-group">
                    <label>ç”Ÿå¹´æœˆæ—¥ <span style="color:#e74c3c;">*</span></label>
                    <div class="date-inputs">
                        <select id="birthYear">
                            <option value="">å¹´</option>
                        </select>
                        <select id="birthMonth">
                            <option value="">æœˆ</option>
                        </select>
                        <select id="birthDay">
                            <option value="">æ—¥</option>
                        </select>
                    </div>
                    <p class="form-error" id="dateError">ç”Ÿå¹´æœˆæ—¥ã‚’é¸æŠã—ã¦ãã ã•ã„</p>
                </div>

                <button class="register-btn" onclick="registerExaminee()">ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹ã™ã‚‹</button>
            </div>
        </div>

        <!-- ãƒ†ã‚¹ãƒˆãƒ•ãƒ­ãƒ¼ç”»é¢ -->
        <div id="testFlowScreen" class="test-flow">
            <div class="flow-container">
                <div class="flow-header">
                    <h2>ãƒ†ã‚¹ãƒˆä¸€è¦§</h2>
                    <p>ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆã‚’é †ç•ªã«å—é¨“ã—ã¦ãã ã•ã„</p>
                </div>

                <div class="examinee-info">
                    <span><strong>å—é¨“è€…:</strong> <span id="displayName"></span></span>
                    <span><strong>ç”Ÿå¹´æœˆæ—¥:</strong> <span id="displayBirth"></span></span>
                </div>

                <div class="flow-steps">
                    <div class="flow-step" id="step1">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <h3>Mensaã‚¿ã‚¤ãƒ—ãƒ†ã‚¹ãƒˆ</h3>
                            <p>å›³å½¢ãƒ‘ã‚¿ãƒ¼ãƒ³èªè­˜ã€æ•°åˆ—å•é¡Œã€è«–ç†ãƒ‘ã‚ºãƒ«ï¼ˆ30å•ãƒ»30åˆ†ï¼‰</p>
                        </div>
                        <button class="step-btn" id="step1Btn" onclick="startTest('mensa')">é–‹å§‹</button>
                    </div>

                    <div class="flow-step locked" id="step2">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <h3>ä¸€èˆ¬æ•™é¤Šãƒ†ã‚¹ãƒˆ</h3>
                            <p>ç§‘å­¦ã€æ­´å²ã€åœ°ç†ã€æ–‡å­¦ãªã©ï¼ˆ15å•ãƒ»10åˆ†ï¼‰</p>
                        </div>
                        <button class="step-btn" id="step2Btn" onclick="startTest('knowledge')" disabled>é–‹å§‹</button>
                    </div>

                    <div class="flow-step locked" id="step3">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <h3>å°è«–æ–‡ãƒ†ã‚¹ãƒˆ</h3>
                            <p>ä¸ãˆã‚‰ã‚ŒãŸãƒ†ãƒ¼ãƒã«ã¤ã„ã¦è«–è¿°ï¼ˆ800ã€œ1200å­—ãƒ»20åˆ†ï¼‰</p>
                        </div>
                        <button class="step-btn" id="step3Btn" onclick="startTest('essay')" disabled>é–‹å§‹</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- å®Œäº†ç”»é¢ -->
        <div id="completeScreen" class="complete-container">
            <div class="flow-container">
                <div class="complete-icon">ğŸ‰</div>
                <h2>ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãŒå®Œäº†ã—ã¾ã—ãŸ</h2>
                <p style="color:#666;margin:20px 0;">ãŠç–²ã‚Œæ§˜ã§ã—ãŸã€‚çµæœã¯ç®¡ç†è€…ç”»é¢ã‹ã‚‰ç¢ºèªã§ãã¾ã™ã€‚</p>
                <button class="register-btn" onclick="resetTest()" style="max-width:300px;margin:0 auto;">æœ€åˆã‹ã‚‰ã‚„ã‚Šç›´ã™</button>
            </div>
        </div>

        <footer>
            <p>&copy; 2026 IQãƒ†ã‚¹ãƒˆ</p>
            <a href="admin.html" style="color:rgba(255,255,255,0.7);text-decoration:none;font-size:0.9rem;">ç®¡ç†è€…ç”»é¢</a>
        </footer>
    </div>

    <script src="js/main.js"></script>
    <script>
        // ç”Ÿå¹´æœˆæ—¥ã®ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã‚’åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            const yearSelect = document.getElementById('birthYear');
            const monthSelect = document.getElementById('birthMonth');
            const daySelect = document.getElementById('birthDay');

            // å¹´ï¼ˆ1940ã€œ2010ï¼‰
            for (let y = 2010; y >= 1940; y--) {
                yearSelect.innerHTML += `<option value="${y}">${y}å¹´</option>`;
            }

            // æœˆ
            for (let m = 1; m <= 12; m++) {
                monthSelect.innerHTML += `<option value="${m}">${m}æœˆ</option>`;
            }

            // æ—¥
            for (let d = 1; d <= 31; d++) {
                daySelect.innerHTML += `<option value="${d}">${d}æ—¥</option>`;
            }

            // ä¿å­˜ã•ã‚ŒãŸçŠ¶æ…‹ã‚’ç¢ºèª
            checkExamineeStatus();
        });

        function checkExamineeStatus() {
            const examinee = Storage.load('currentExaminee');

            if (examinee) {
                document.getElementById('displayName').textContent = examinee.name;
                document.getElementById('displayBirth').textContent = examinee.birthDate;

                document.getElementById('registrationScreen').style.display = 'none';
                document.getElementById('testFlowScreen').style.display = 'block';

                updateTestFlow(examinee);
            }
        }

        function registerExaminee() {
            const name = document.getElementById('examineeName').value.trim();
            const year = document.getElementById('birthYear').value;
            const month = document.getElementById('birthMonth').value;
            const day = document.getElementById('birthDay').value;

            let valid = true;

            // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
            if (!name) {
                document.getElementById('nameError').style.display = 'block';
                valid = false;
            } else {
                document.getElementById('nameError').style.display = 'none';
            }

            if (!year || !month || !day) {
                document.getElementById('dateError').style.display = 'block';
                valid = false;
            } else {
                document.getElementById('dateError').style.display = 'none';
            }

            if (!valid) return;

            const birthDate = `${year}å¹´${month}æœˆ${day}æ—¥`;

            const examinee = {
                name: name,
                birthDate: birthDate,
                birthYear: year,
                birthMonth: month,
                birthDay: day,
                registeredAt: new Date().toISOString(),
                completedTests: []
            };

            Storage.save('currentExaminee', examinee);

            document.getElementById('displayName').textContent = name;
            document.getElementById('displayBirth').textContent = birthDate;

            document.getElementById('registrationScreen').style.display = 'none';
            document.getElementById('testFlowScreen').style.display = 'block';

            updateTestFlow(examinee);
        }

        function updateTestFlow(examinee) {
            const completed = examinee.completedTests || [];

            // ã‚¹ãƒ†ãƒƒãƒ—1: Mensa
            if (completed.includes('mensa')) {
                document.getElementById('step1').classList.remove('active');
                document.getElementById('step1').classList.add('completed');
                document.getElementById('step1Btn').outerHTML = '<span class="step-status">âœ“ å®Œäº†</span>';

                // ã‚¹ãƒ†ãƒƒãƒ—2ã‚’æœ‰åŠ¹åŒ–
                document.getElementById('step2').classList.remove('locked');
                document.getElementById('step2').classList.add('active');
                document.getElementById('step2Btn').disabled = false;
            } else {
                document.getElementById('step1').classList.add('active');
            }

            // ã‚¹ãƒ†ãƒƒãƒ—2: ä¸€èˆ¬æ•™é¤Š
            if (completed.includes('knowledge')) {
                document.getElementById('step2').classList.remove('active');
                document.getElementById('step2').classList.add('completed');
                document.getElementById('step2Btn').outerHTML = '<span class="step-status">âœ“ å®Œäº†</span>';

                // ã‚¹ãƒ†ãƒƒãƒ—3ã‚’æœ‰åŠ¹åŒ–
                document.getElementById('step3').classList.remove('locked');
                document.getElementById('step3').classList.add('active');
                document.getElementById('step3Btn').disabled = false;
            }

            // ã‚¹ãƒ†ãƒƒãƒ—3: å°è«–æ–‡
            if (completed.includes('essay')) {
                document.getElementById('step3').classList.remove('active');
                document.getElementById('step3').classList.add('completed');
                document.getElementById('step3Btn').outerHTML = '<span class="step-status">âœ“ å®Œäº†</span>';

                // å…¨å®Œäº†
                document.getElementById('testFlowScreen').style.display = 'none';
                document.getElementById('completeScreen').style.display = 'block';
            }
        }

        function startTest(type) {
            if (type === 'mensa') {
                location.href = 'tests/mensa.html';
            } else if (type === 'knowledge') {
                location.href = 'tests/knowledge.html';
            } else if (type === 'essay') {
                location.href = 'tests/essay.html';
            }
        }

        function resetTest() {
            Storage.remove('currentExaminee');
            location.reload();
        }
    </script>
</body>
</html>
